//
//  BaseLoginController.swift
//  登录相关公共界面
//
//  Created by smile on 2022/7/7.
//

import UIKit

class BaseLoginController: BaseTitleController {
    /// 登录
    /// - Parameter data: <#data description#>
    func login(_ data:User) {
        //推送id
        data.push = "push"

        //设备id，就是谁谁的iPhone 这样的名称
        data.device = UIDevice.current.name

        DefaultRepository.shared
                .login(data)
                .subscribeSuccess {[weak self] data in
                    self?.onLogin(data.data!)
                }.disposed(by: rx.disposeBag)
    }

    func onLogin(_ data:Session) {
        //保存登录信息
        PreferenceUtil.setSession(data.session)
        PreferenceUtil.setUserId(data.userId)
        PreferenceUtil.setChatSession(data.chatToken)

        AppDelegate.shared.onLogin(data)
    }
}
